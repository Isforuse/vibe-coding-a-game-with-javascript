:root{
  --rows:5;
  --cols:7;
  --cell:100px;
  --gap:6px;
  --card-w:120px;
  --accent:#38bdf8;
  --danger:#ef4444;
  --ok:#22c55e;
  --warn:#f59e0b;
  --grass1:#9be180;
  --grass2:#87d46e;
  --panel:#0f172a;
  --slate:#111827;
  --text:#e5e7eb;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--text);
  background:linear-gradient(180deg,#0b1220,#0b1325 40%,#0e1a2f 100%);
}
#app{max-width:980px;margin:0 auto;padding:14px}
.topbar{
  display:flex;justify-content:space-between;align-items:center;
  background:#0b1220;border:1px solid #1f2937;border-radius:12px;
  padding:10px 14px;box-shadow:0 8px 24px rgba(0,0,0,.25)
}
.hud{display:flex;gap:16px;align-items:center}
.hud-item{background:#0c1324;border:1px solid #1f2937;border-radius:10px;padding:8px 12px}
.hud-item span{opacity:.8;margin-right:6px}
.controls button{
  background:#1f2937;color:var(--text);border:1px solid #374151;border-radius:10px;
  padding:8px 14px;cursor:pointer
}
.controls button[disabled]{opacity:.5;cursor:not-allowed}
.playfield-wrap{
  position:relative;margin:16px 0 12px;border-radius:16px;overflow:hidden;
  border:1px solid #1f2937;box-shadow:0 12px 30px rgba(0,0,0,.3)
}
.grid{
  position:relative;
  display:grid;
  grid-template-columns:repeat(var(--cols), var(--cell));
  grid-template-rows:repeat(var(--rows), var(--cell));
  gap:var(--gap);
  padding:var(--gap);

  /* === 棋盤格背景 === */
  background:
    linear-gradient(90deg, #9be180 50%, #87d46e 50%),
    linear-gradient(#9be180 50%, #87d46e 50%);
  background-size: calc(var(--cell) * 2) calc(var(--cell) * 2);

  min-height:calc(var(--rows) * var(--cell) + (var(--rows)+1) * var(--gap));
}
.cell{
  width:var(--cell);height:var(--cell);
  background:transparent; /* 背景交由棋盤格控制 */
  border:2px solid rgba(255,255,255,.25); /* 更明顯的格線 */
  border-radius:6px;
  position:relative;
}
.entity{
  position:absolute;
  width:var(--cell);height:var(--cell);
  display:flex;align-items:center;justify-content:center;
  left:0;top:0;
}
.entity img{
  width:60px;height:60px;object-fit:contain;filter:drop-shadow(0 2px 2px rgba(0,0,0,.5))
}
.entity.wall-healthy{outline:3px solid var(--ok);outline-offset:-6px;border-radius:14px}
.entity.wall-warn{outline:3px solid var(--warn);outline-offset:-6px;border-radius:14px}
.entity.wall-danger{outline:3px solid var(--danger);outline-offset:-6px;border-radius:14px}
.bullet{
  position:absolute;width:30px;height:30px;
  display:flex;align-items:center;justify-content:center;pointer-events:none
}
.bullet img{width:30px;height:30px;object-fit:contain}
.zombie{
  position:absolute;width:var(--cell);height:var(--cell);
  display:flex;align-items:center;justify-content:center;
}
.zombie img{
  width:60px;height:60px;object-fit:contain;filter:drop-shadow(0 2px 2px rgba(0,0,0,.5))
}
.zombie.boss img{width:100px;height:100px}

.panel{
  display:flex;gap:12px;justify-content:center;align-items:stretch;
  padding:12px;background:var(--panel);border:1px solid #1f2937;border-radius:12px
}
.card{
  width:var(--card-w);background:#111827;border:1px solid #253047;border-radius:12px;
  padding:8px;cursor:pointer;display:grid;grid-template-rows:auto auto auto;row-gap:6px;
  transition:transform .12s ease, box-shadow .12s ease; position:relative; overflow:hidden
}
.card:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(0,0,0,.35)}
.card.selected{outline:2px solid var(--accent);outline-offset:2px}
.card .img-wrap{display:flex;justify-content:center;align-items:center;height:72px}
.card img{width:60px;height:60px;object-fit:contain}
.card .label{text-align:center;font-weight:600}
.card .cost{background:#0b1220;border:1px solid #223047;border-radius:8px;text-align:center;padding:4px}
.card.disabled{opacity:.45;cursor:not-allowed}
.cooldown-bar{
  position:absolute;left:0;bottom:0;height:0%;width:100%;
  background:linear-gradient(180deg, rgba(56,189,248,.15), rgba(56,189,248,.35));
  pointer-events:none;transition:height .2s linear
}

.message{
  position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
  background:rgba(10,14,24,.72);backdrop-filter:blur(2px);
  font-size:28px;font-weight:700;text-align:center;padding:20px;z-index:5
}
.hidden{display:none}

.music{
  display:flex;align-items:center;gap:10px;margin-top:10px;opacity:.85
}
.music-note{font-size:22px}
.hint{font-size:12px;opacity:.7}
/* === 血量條 === */
.hp-bar {
  position: absolute;
  bottom: 4px;
  left: 6px;
  width: 80%;
  height: 6px;
  background: rgba(0,0,0,0.4);
  border: 1px solid rgba(255,255,255,0.3);
  border-radius: 3px;
  overflow: hidden;
}
.hp-fill {
  height: 100%;
  background: linear-gradient(to right, #22c55e, #16a34a);
  width: 100%;
  transition: width 0.2s linear;
}

.explosion {
  pointer-events: none;
  animation: explode 1s ease-out forwards;
  z-index: 999;
}

@keyframes explode {
  0%   { transform: scale(0.5) rotate(0deg); opacity: 1; }
  50%  { transform: scale(1.5) rotate(180deg); opacity: 1; }
  100% { transform: scale(2.0) rotate(360deg); opacity: 0; }
}
